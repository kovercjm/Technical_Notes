# What is OAuth 2.0
OAuth 2.0 is the industry-standard protocol for authorization.

*Reference*:

* [OAuth 2 Specification](https://oauth.net/2/)
* [OAuth 2 Simplified](https://aaronparecki.com/oauth-2-simplified/)

# Protocol Flow Chart
```
     +--------+                               +---------------+
     |        |--(A)- Authorization Request ->|   Resource    |
     |        |                               |     Owner     |
     |        |<-(B)-- Authorization Grant ---|               |
     |        |                               +---------------+
     |        |
     |        |                               +---------------+
     |        |--(C)-- Authorization Grant -->| Authorization |
     | Client |                               |     Server    |
     |        |<-(D)----- Access Token -------|               |
     |        |                               +---------------+
     |        |
     |        |                               +---------------+
     |        |--(E)----- Access Token ------>|    Resource   |
     |        |                               |     Server    |
     |        |<-(F)--- Protected Resource ---|               |
     +--------+                               +---------------+
```

# Roles
## *Client* - The Third-Party Application
The client is the application that is attempting to get access to the user's account. It needs to get permission from the user before it can do so.
## *Resource Server* - The API
The resource server is the API server used to access the user's information.
## *The Authorization Server*
This is the server that presents the interface where the user approves or denies the request. In smaller implementations, this may be the same server as the API server, but larger scale deployments will often build this as a separate component.
## *Resource Owner* - The User
The resource owner is the person who is giving access to some portion of their account.

# What the *Client* needs 
A new app shall be registered with the service. When registering, a redirect URI is a must to be used for redirecting users to for web server, browser-based, or mobile apps.
## Redirect URIs
The service will only redirect users to a registered URI, which helps prevent some attacks. Any HTTP redirect URIs must be protected with TLS security, so the service will only redirect to URIs beginning with "https". This prevents tokens from being intercepted during the authorization process.
## Client ID and Secret
After registering, you will receive a client ID and a client secret. The client ID is considered public information, and is used to build login URLs, or included in Javascript source code on a page. The client secret must be kept confidential. If a deployed app cannot keep the secret confidential, such as single-page Javascript apps or native apps, then the secret is not used, and ideally the service shouldn't issue a secret to these types of apps in the first place.

# Grant Types

- **Authorization Code** for apps running on a web server, browser-based and mobile apps
- **Password** for logging in with a username and password
- **Client credentials** for application access
- **Implicit** was previously recommended for clients without a secret, but has been superseded by using the Authorization Code grant with no secret.

# Web server APP use case
## 1 Authorization
Create a "Log In" link sending the user to:
```
https://authorization-server.com/auth?response_type=code&client_id=CLIENT_ID&redirect_uri=REDIRECT_URI&scope=photos&state=1234zyx
```

- *response_type=code* - Indicates that your server expects to receive an authorization code
- *client_id* - The client ID you received when you first created the application
- *redirect_uri* - Indicates the URI to return the user to after authorization is complete
- *scope* - One or more scope values indicating which parts of the user's account you wish to access
- *state* - A random string generated by your application, which you'll verify later

If the user clicks "Allow" at the authorization prompt, the service redirects the user back to your site with an auth code:
```
https://example-app.com/cb?code=AUTH_CODE_HERE&state=1234zyx
```

- *code* - The server returns the authorization code in the query string
- *state* - The server returns the same state value that you passed

You should first compare this state value to ensure it matches the one you started with. You can typically store the state value in a cookie or session, and compare it when the user comes back. This ensures your redirection endpoint isn't able to be tricked into attempting to exchange arbitrary authorization codes.

## 2 Token Exchange
Your server exchanges the auth code for an access token:
```
POST https://api.authorization-server.com/token
  grant_type=authorization_code&
  code=AUTH_CODE_HERE&
  redirect_uri=REDIRECT_URI&
  client_id=CLIENT_ID&
  client_secret=CLIENT_SECRET
```
- *grant_type=authorization_code* - The grant type for this flow is authorization_code
- *code=AUTH_CODE_HERE* - This is the code you received in the query string
- *redirect_uri=REDIRECT_URI* - Must be identical to the redirect URI provided in the original link
- *client_id=CLIENT_ID* - The client ID you received when you first created the application
- *client_secret=CLIENT_SECRET* - Since this request is made from server-side code, the secret is included

The server replies with an access token and expiration time
```
{
  "access_token":"RsT5OjbzRn430zqMLgV3Ia",
  "expires_in":3600
}
```
or if there was an error
```
{
  "error":"invalid_request"
}
```
Security: Note that the service must require apps to pre-register their redirect URIs.